# Tess

## 名词解释

Entity: Tess 中的特征数据结构，包括 id type value 三个字段，业务根据 type 区分不同类型；

Match: 将 Impression 数据和多个 Entity 数据，根据 Impression 中的 entities 字段拼接到一起，就能得到一条完整的样本。

FE: 特征抽取模块。

Entity -> Match -> FE

灰度发布：在生产环境中逐步向用户群体推出新功能或版本的方式。

Benchmark：基准测试，通过运行特定的测试任务来评估系统或组件在执行这些任务时的效率和速度，从而提供性能指标。

DSSM: Deep Structured Semantic Models，一个深度学习模型。

Appcfg：应用程序配置。

A/B 测试：（也被称为对比测试和分桶测试）旨在用于对比两个版本的内容的效果，识别哪一个版本对于访客/查看者更具吸引力。

ANTLR4：解析器生成器，用于读取、处理、执行或翻译结构化文本或二进制文件。

## Merger 流程

### 1. Request

- 用户请求进入系统，开始处理流程。

### 2. InitFlow

- 请求合法性校验：首先对请求进行基本的合法性检查。
- 参数校验：检查 `Abt` 和 `Appcfg` 的参数配置是否合规。
- 粗糙排序算法校验：根据配置驱动，进行粗糙的排序算法检查。

### 3. RedisFlow

- 预读取 Redis 数据：预先从 Redis 或 Tendis 数据库中读取必要的数据，如用户信息（User）和用户实时特征（UserRT）。

### 4. PrerankFlow

- Entity 数据初步拼接：进行数据的初步拼接和整合。
- 业务逻辑操作：进行一些业务逻辑的处理，如去重等操作。
- 下游算法调用：根据语法规则调用不同的下游算法，生成初步排序结果。

### 5. CreativeFlow

- 创意召回：创建召回口，扩展和生成创意列表（ListEntity）。
- 构造 ListEntity：对召回的创意进行整理，形成列表。
- 多选：从多个候选中选择合适的创意。

### 6. RankFlow

- Entity 数据初步拼接：再次进行数据的拼接。
- 下游算法调用：调用不同的排序算法，生成最终排序结果。
- 结果拼接：将结果整合到一起，并支持多次算法调用。

### 7. MixerFlow

- 融合服务：使用 Mixer 服务对结果进行融合，生成打分和权重，算法更灵活。

### 8. UnifiedFlow

- Entity 数据初步拼接：统一格式的数据拼接。
- 独立任务生成：根据语法生成独立任务，调用不同的下游算法。
- 保持主流程性能：确保不影响主流程的性能。

### 9. Response

- 最终生成的响应返回给用户，结束流程。

### 10. MergerLog (Kafka)

- 日志记录：通过 Kafka 记录合并请求、排序响应、精排响应、实体数据等日志，用于后续的离线分析。

### 11. Offline

- 离线分析：对 Kafka 中的日志数据进行离线分析，用于模型训练、效果评估等。

### TessClient

- Tess 模型调用：根据流程中的需求，调用不同的模型（如 `tess2.mmoe`, `tess3.deepx` 等）来处理特定的任务。

### 配置与数据

- UnifiedStore：用于管理和存储 Entity 元信息。
- Appcfg 动态配置：包括 Redis 信息、Kafka 配置信息等，决定流程中的一些动态行为。
