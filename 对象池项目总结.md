# 对象池项目总结

## 代码规范及风格

- 注意文档和代码的可读性，遵守规范。

- 团队间要保证相同的规范，提高工作效率，避免错误。

- 常用的或繁琐的操作要工具化和自动化。

- 笔记和代码用标准化和格式化的工具。

- 任何语言在 IDE 开发的三要素：编译、静态分析、格式化。

### 优秀代码的要素

- 一致性

  - 文件名、`namesapce` 名字、类名等保持一致。

  - 命名风格的一致性。

  - 定义的顺序和初始化的顺序对应。

  - 一些方法要配套使用，不能省略。

    - 例如 `size()` 和 `empty()`，`begin()` 和 `cbegin()`，`end()` 和 `cend()` 等。

- 可读性

  - 变量名、宏名等名称需要表达出确切的含义，不能影响理解。

  - 使用垂直留白保持段落感，分隔不同事务/段落。

- 性能

  - 对需要使用的空间进行预先分配。

  - 使用 `emplace_back` 原地向末尾添加元素，避免产生临时对象。

  - 在实现对象池时“打开”函数、“关闭”函数都可以被多次调用，能够实现对象复用。

- 最佳实践

  - 不要总是用相同的代码解决相同的问题。（DRY 原则）

  - 对于实现对象池中的接口使用智能指针。

    - 在语言层面保证用户使用不会出现问题。

  - 类方法在类内实现。

    - 避免多写冗长类型名及模板参数。

    - 可扩展性好。

  - 对于实现基础库或工具类程序，定义类型时可以使用类似 STL 的命名方式，全小写 + 下划线。

    - 使用 `smart_pointer` 保持对原有版本的兼容性。

    - 使用 `shared_pointer` 是后续对原有版本的扩展。

### 测试

- 测试前确定测试的目的以及要测试的内容。
- 对于多项测试可以合并使用宏，避免堆砌大量重复代码，宏名要能够精炼的描述宏的用途。
- 如果没有合适的描述，可以使用 `DEFINE_TEST` 来表示自定义的一个测试。
- 确保宏定义中的参数名称不与外部变量或函数名冲突，避免无效声明和意外的行为。

```C++
// 反例
TEST_F(ObjectPoolTest, All) {
#define DEFINE_TEST(size, a_counter)  \
  do {                                \
    EXPECT_EQ(pool.size(), size);     \
    EXPECT_EQ(A::counter, a_counter); \
  } while (0)

  ObjectPool<A> pool;

  pool.init(3);
  DEFINE_TEST(3u, 3u);
  //...
}
```

```plain
error: expected unqualified-id
```

```C++
#define DEFINE_TEST(pool_size, a_counter) \
  do {                                    \
    EXPECT_EQ(pool.size(), pool_size);    \
    EXPECT_EQ(A::counter, a_counter);     \
  } while (0)
```

- 测试的每一步都要符合预期，不能只看阶段性的结果。

### 对象池实现

- 重点是实现对象的复用。

- “打开”函数和“关闭”函数都可以被多次调用。

- 超出对象最大限制后需要能够创建新的对象给用户。

- 对象使用完放回对象池，若对象池已满则直接释放该对象。

- 保证调用的健壮性。

## 心得体会

- 深刻体会到要先配置好工作环境再开始工作的重要性。

- 应该认真再认真阅读文档，需要的东西大多在里面，避免低级错误。

- 遵守代码规范可以规避掉很多错误，并且看起来很美观，要时刻想到优秀代码的四个原则。

- 要善于使用现成的工具，手敲命令易错且麻烦。

- 还需要加强命令使用的熟练度。

- 要及时整理笔记回顾问题，笔记要精炼且能看懂和解释。
